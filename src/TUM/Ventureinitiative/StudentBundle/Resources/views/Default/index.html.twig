{% extends 'CoreBundle:Backend:base.html.twig' %}

{% block title %}Overview - Students{% endblock %}

{% block content %}
    
    <div class="container">
    
<h1>Students Overview</h1>

<hr />

<br />

<div class="row">

	<div class="col-md-6">
		
		<p>Add new student <a href="{{ path('tum_ventureinitiative_student_add') }}" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-plus"></span></a></p>
		
	</div>
	
	<div class="col-md-6">
	
		{{ form_start(searchForm) }}
	
			{% if not searchForm.vars.valid %}
			<div class="alert alert-danger">
				{{ form_errors(searchForm) }}
			</div>
			{% endif %}
				
			<div class="form-group">
			
				{{ form_errors(searchForm.query) }}
				
				<div class="input-group">
					<span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
					{{ form_widget(searchForm.query, {'attr': {'class': 'form-control'}}) }}
				</div>
			
			</div>
		
			{{ form_widget(searchForm.searchSubmit, {'attr': {'class': 'btn btn-primary'}}) }}
		
		{{ form_end(searchForm) }}

	</div>

</div>

<br />
<br />
<br />

<table class="table table-hover">

	<thead>
		
		<tr>
			<th>Id</th>
			<th>Name</th>
			<th>Firstname</th>
			<th>E-Mail</th>
			<th>Options</th>
		</tr>

	</thead>

	<tbody>
		
		{% for student in students %}	
		
		<tr>
			<td>{{ student.id }}</td>
			<td>{{ student.lastname }}</td>
			<td>{{ student.firstname }}</td>
			<td>{{ student.email }}</td>
			<td>
				<a href="{{ path('tum_ventureinitiative_student_edit', {'id': student.id}) }}" class="btn btn-default btn-sm">
					<span class="glyphicon glyphicon-pencil"></span>
				</a>
				<!-- <a href="{{ path('tum_ventureinitiative_student_delete', {'id': student.id}) }}"> -->
					<a href="#deleteStudentModal" class="btn btn-default btn-sm" data-toggle="modal" data-target="#deleteStudentModal" data-confirm-url="{{ path('tum_ventureinitiative_student_delete', {'id': student.id}) }}" data-student-info="{{ student.firstname }} {{ student.lastname }} ({{ student.email }})">
						<span class="glyphicon glyphicon-trash"></span>
					</a>
				<!-- </a> -->
			</td>
		</tr>

		{% endfor %}

	</tbody>
	
</table>

<center>


{% if pageCount > 1 %}
{% set extremePagesLimit = 3 %}
{% set nearbyPagesLimit = 2 %}
{% set paginationPath = 'tum_ventureinitiative_student_paged_overview' %}

<ul class="pagination">
	
	{% if page < 2 %}
	
		<li class="disabled"><a href="">&laquo;</a></li>
		
	{% else %}
	
		<li><a href="{{ path(paginationPath, {'page': page - 1}) }}">&laquo;</a></li>
		
	{% endif %}
    
   
   	{% for i in range(1, extremePagesLimit) if ( i < page - nearbyPagesLimit ) %}
        <li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
    {% endfor %}

    {% if extremePagesLimit + 1 < page - nearbyPagesLimit %}
        <li><span class="sep-dots">...</span></li>
    {% endif %}

    {% for i in range(page-nearbyPagesLimit, page-1) if ( i > 0 ) %}
        <li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
    {% endfor %}
    
    	<li class="active"><a href="{{ path(paginationPath, { 'page': page }) }}">{{ page }}</a></li>

   	
    {% if page < pageCount %}
    
        {% for i in range(page + 1, pageCount) %} 
        	{% if ( loop.index <= nearbyPagesLimit and i <= pageCount ) %}
            	<li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
            {% endif %}
        {% endfor %}

        {% if  (pageCount - extremePagesLimit) > (page + nearbyPagesLimit ) %}
            <li><span class="sep-dots">...</span></li>
        {% endif %}

        {% for i in range(pageCount - extremePagesLimit + 1, pageCount) if ( i > page + nearbyPagesLimit ) %}
            <li><a href="{{ path(paginationPath, {'page': i - 1}) }}">{{ i }}</a></li>
    	{% endfor %}
    	
    {% endif %}

    {% if page < pageCount %}
    
    	<li><a href="{{ path(paginationPath, {'page': page + 1}) }}">&raquo;</a></li>
    
    {% else %}
    	
    	<li class="disabled"><a href="">&raquo;</a></li>
    	
    {% endif %}
    
</ul>
{% endif %}


</center>

<!-- Modals -->

<div class="modal fade" id="deleteStudentModal" tabindex="-1" role="dialog" aria-labelledby="deleteStudentModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Delete User</h4>
			</div>
			<div class="modal-body">
				Are you sure you want to delete the following user: <span id="modalStudentInfo"></span>
			</div>
			<div class="modal-footer">
				<a class="btn btn-default" data-dismiss="modal">Abort</a>
				<a class="btn btn-danger">Delete</a>
			</div>
		</div>
	</div>
</div>

</div>
	
{% endblock %}

{% block javascript %}
	
	{{ parent() }}

	<script type="text/javascript">

		$(document).ready(function(){

			$('#deleteStudentModal').on('show.bs.modal', function(e) {

				var $trigger = $(e.relatedTarget);

				console.log($trigger);
				
				var $confirmUrl = $trigger.data('confirmUrl');
				var $studentInfo = $trigger.data('studentInfo');

				if($confirmUrl !== undefined) {
		            $(this).find('.btn-danger')
		                .attr('href', $confirmUrl)
		                .click(function() { $this.modal('hide'); });

	                $(this).find('#modalStudentInfo').html('<br /><br /><b>' + $studentInfo + '</b>');
		        }
				
			});
				
		});
	
	</script>

{% endblock %}