{% extends '::base.html.twig' %}

{% block title %}Overview - User Management{% endblock %}

{% block navigation %} 

	{{ knp_menu_render('main', {'currentClass': 'active'}) }} 

	<p class="navbar-text pull-right">
            <a href="#"><span class="glyphicon glyphicon-user"></span></a>
            Nicola Breugst | <a href="#">Logout</a></p>
	
{% endblock %}

{% block content %}
    
    <div class="container">
    
<h1>Overview</h1>

<hr />

<br />

<div class="row">

	<div class="col-md-6">
		
		<p>Add new users <a href="{{ path('user_management_add_user') }}" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-plus"></span></a></p>
		
	</div>
	
	<div class="col-md-6">
	
		{{ form_start(searchForm) }}
	
			{% if not searchForm.vars.valid %}
			<div class="alert alert-danger">
				{{ form_errors(searchForm) }}
			</div>
			{% endif %}
				
			<div class="form-group">
			
				{{ form_errors(searchForm.query) }}
				
				<div class="input-group">
					<span class="input-group-addon"><span class="glyphicon glyphicon-search"></span></span>
					{{ form_widget(searchForm.query, {'attr': {'class': 'form-control'}}) }}
				</div>
			
			</div>
		
			{{ form_widget(searchForm.searchSubmit, {'attr': {'class': 'btn btn-primary'}}) }}
		
		{{ form_end(searchForm) }}

	</div>

</div>

<br />
<br />
<br />

<table class="table table-hover">

	<thead>
		
		<tr>
			<th>Id</th>
			<th>Name</th>
			<th>Firstname</th>
			<th>E-Mail</th>
			<th>Options</th>
		</tr>

	</thead>

	<tbody>
		
		{% for user in users %}	
		
		<tr>
			<td>{{ user.id }}</td>
			<td>{{ user.lastname }}</td>
			<td>{{ user.firstname }}</td>
			<td>{{ user.email }}</td>
			<td>
				<a href="{{ path('user_management_edit_user', {'id': user.id}) }}" class="btn btn-default btn-sm">
					<span class="glyphicon glyphicon-pencil"></span>
				</a>
				<!-- <a href="{{ path('user_management_delete_user', {'id': user.id}) }}"> -->
					<a href="#deleteUserModal" class="btn btn-default btn-sm" data-toggle="modal" data-confirm-url="{{ path('user_management_delete_user', {'id': user.id}) }}" data-user-info="{{ user.firstname }} {{ user.lastname }} ({{ user.email }})">
						<span class="glyphicon glyphicon-trash"></span>
					</a>
				<!-- </a> -->
			</td>
		</tr>

		{% endfor %}

	</tbody>
	
</table>

<center>


{% if pagingConfig.pageCount > 1 %}
{% set extremePagesLimit = 3 %}
{% set nearbyPagesLimit = 2 %}
{% set paginationPath = 'user_management_homepage_paging' %}

<ul class="pagination">
	
	{% if pagingConfig.page < 2 %}
	
		<li class="disabled"><a href="">&laquo;</a></li>
		
	{% else %}
	
		<li><a href="{{ path(paginationPath, {'page': pagingConfig.page - 1}) }}">&laquo;</a></li>
		
	{% endif %}
    
   
   	{% for i in range(1, extremePagesLimit) if ( i < pagingConfig.page - nearbyPagesLimit ) %}
        <li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
    {% endfor %}

    {% if extremePagesLimit + 1 < pagingConfig.page - nearbyPagesLimit %}
        <li><span class="sep-dots">...</span></li>
    {% endif %}

    {% for i in range(pagingConfig.page-nearbyPagesLimit, pagingConfig.page-1) if ( i > 0 ) %}
        <li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
    {% endfor %}
    
    	<li class="active"><a href="{{ path(paginationPath, { 'page': pagingConfig.page }) }}">{{ pagingConfig.page }}</a></li>

   	
    {% if pagingConfig.page < pagingConfig.pageCount %}
    
        {% for i in range(pagingConfig.page + 1, pagingConfig.pageCount) %} 
        	{% if ( loop.index <= nearbyPagesLimit and i <= pagingConfig.pageCount ) %}
            	<li><a href="{{ path(paginationPath, {'page': i }) }}">{{ i }}</a></li>
            {% endif %}
        {% endfor %}

        {% if  (pagingConfig.pageCount - extremePagesLimit) > (pagingConfig.page + nearbyPagesLimit ) %}
            <li><span class="sep-dots">...</span></li>
        {% endif %}

        {% for i in range(pagingConfig.pageCount - extremePagesLimit + 1, pagingConfig.pageCount) if ( i > pagingConfig.page + nearbyPagesLimit ) %}
            <li><a href="{{ path(paginationPath, {'page': i - 1}) }}">{{ i }}</a></li>
    	{% endfor %}
    	
    {% endif %}

    {% if pagingConfig.page < pagingConfig.pageCount %}
    
    	<li><a href="{{ path(paginationPath, {'page': pagingConfig.page + 1}) }}">&raquo;</a></li>
    
    {% else %}
    	
    	<li class="disabled"><a href="">&raquo;</a></li>
    	
    {% endif %}
    
</ul>
{% endif %}


</center>

<!-- Modals -->

<div class="modal fade" id="deleteUserModal" tabindex="-1" role="dialog" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Delete User</h4>
			</div>
			<div class="modal-body">
				Are you sure you want to delete the following user: <span id="modalUserInfo"></span>
			</div>
			<div class="modal-footer">
				<a class="btn btn-default" data-dismiss="modal">Abort</a>
				<a class="btn btn-danger">Delete</a>
			</div>
		</div>
	</div>
</div>

</div>
	
{% endblock %}

{% block javascript %}
	
	{{ parent() }}

	<script type="text/javascript">

		$(document).ready(function(){

			$('#deleteUserModal').on('show.bs.modal', function() {

				var $this = $(this),
					id = $this.attr('id'),
					filter = '[href="#' + id + '"],[data-target="#' + id  + '"]',
		            trigger = $('[data-toggle="modal"]').filter(filter),
		            confirmUrl = trigger.data('confirmUrl');

				var $this = $(this),
					id = $this.attr('id'),
					filter = '[href="#' + id + '"],[data-target="#' + id  + '"]',
		            trigger = $('[data-toggle="modal"]').filter(filter),
		            userInfo = trigger.data('userInfo');

				if(confirmUrl !== undefined) {
		            $this.find('.btn-danger')
		                .attr('href', confirmUrl)
		                .click(function() { $this.modal('hide'); });

	                $this.find('#modalUserInfo').html('<br /><br /><b>' + userInfo + '</b>');
		        }
				
			});
				
		});
	
	</script>

{% endblock %}